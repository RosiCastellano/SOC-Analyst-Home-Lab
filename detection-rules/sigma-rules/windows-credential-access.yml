title: LSASS Memory Access - Credential Dumping
id: a0f13a58-4f30-4f6e-9d5c-8b2f2e5d8b4a
status: stable
description: Detects access to LSASS process memory, commonly used for credential dumping
references:
    - https://attack.mitre.org/techniques/T1003/001/
    - https://github.com/RosiCastellano/SOC-Analyst-Home-Lab
author: SOC Analyst Home Lab
date: 2024/01/01
modified: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1003.001
logsource:
    category: process_access
    product: windows
detection:
    selection:
        TargetImage|endswith: '\lsass.exe'
    filter_system:
        SourceImage|endswith:
            - '\csrss.exe'
            - '\wininit.exe'
            - '\services.exe'
            - '\svchost.exe'
            - '\lsass.exe'
    filter_av:
        SourceImage|contains:
            - '\MsMpEng.exe'
            - '\MpCmdRun.exe'
            - '\NisSrv.exe'
    condition: selection and not filter_system and not filter_av
falsepositives:
    - Legitimate security tools
    - System administration tools
level: critical

---

title: Mimikatz Command Line Detection
id: b1c2d3e4-5f6a-7b8c-9d0e-f1a2b3c4d5e6
status: stable
description: Detects Mimikatz execution based on command line arguments
references:
    - https://attack.mitre.org/techniques/T1003/
    - https://github.com/gentilkiwi/mimikatz
author: SOC Analyst Home Lab
date: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1003
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        CommandLine|contains:
            - 'sekurlsa'
            - 'kerberos::list'
            - 'kerberos::ptt'
            - 'crypto::capi'
            - 'privilege::debug'
            - 'lsadump'
            - 'token::elevate'
            - 'vault::cred'
    condition: selection
falsepositives:
    - Legitimate penetration testing
    - Security assessments
level: critical

---

title: SAM Database Dump via Registry
id: c2d3e4f5-6a7b-8c9d-0e1f-2a3b4c5d6e7f
status: stable
description: Detects SAM database dumping via reg.exe save command
references:
    - https://attack.mitre.org/techniques/T1003/002/
author: SOC Analyst Home Lab
date: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1003.002
logsource:
    category: process_creation
    product: windows
detection:
    selection_reg:
        Image|endswith: '\reg.exe'
    selection_params:
        CommandLine|contains|all:
            - 'save'
        CommandLine|contains:
            - '\sam'
            - '\system'
            - '\security'
    condition: selection_reg and selection_params
falsepositives:
    - Legitimate backup operations
level: critical

---

title: Volume Shadow Copy for Credential Access
id: d3e4f5a6-7b8c-9d0e-1f2a-3b4c5d6e7f8a
status: stable
description: Detects creation of volume shadow copies which may be used to access NTDS.dit
references:
    - https://attack.mitre.org/techniques/T1003/003/
author: SOC Analyst Home Lab
date: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1003.003
logsource:
    category: process_creation
    product: windows
detection:
    selection_vssadmin:
        Image|endswith: '\vssadmin.exe'
        CommandLine|contains|all:
            - 'create'
            - 'shadow'
    selection_wmic:
        Image|endswith: '\wmic.exe'
        CommandLine|contains|all:
            - 'shadowcopy'
            - 'create'
    selection_ntdsutil:
        Image|endswith: '\ntdsutil.exe'
        CommandLine|contains:
            - 'activate instance ntds'
            - 'ifm'
    condition: selection_vssadmin or selection_wmic or selection_ntdsutil
falsepositives:
    - Legitimate backup operations
    - System administrators
level: high

---

title: Procdump LSASS Dump
id: e4f5a6b7-8c9d-0e1f-2a3b-4c5d6e7f8a9b
status: stable
description: Detects procdump usage targeting LSASS for credential dumping
references:
    - https://attack.mitre.org/techniques/T1003/001/
author: SOC Analyst Home Lab
date: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1003.001
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        Image|endswith: '\procdump.exe'
        CommandLine|contains: 'lsass'
    selection_alt:
        Image|endswith: '\procdump64.exe'
        CommandLine|contains: 'lsass'
    condition: selection or selection_alt
falsepositives:
    - Legitimate debugging
level: critical

---

title: Comsvcs.dll MiniDump for LSASS
id: f5a6b7c8-9d0e-1f2a-3b4c-5d6e7f8a9b0c
status: stable
description: Detects usage of comsvcs.dll MiniDump for LSASS credential dumping
references:
    - https://attack.mitre.org/techniques/T1003/001/
author: SOC Analyst Home Lab
date: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1003.001
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        Image|endswith: '\rundll32.exe'
        CommandLine|contains|all:
            - 'comsvcs'
            - 'MiniDump'
    condition: selection
falsepositives:
    - Rare legitimate usage
level: critical

---

title: Kerberoasting - Suspicious Service Ticket Request
id: a6b7c8d9-0e1f-2a3b-4c5d-6e7f8a9b0c1d
status: stable
description: Detects potential Kerberoasting attack via RC4 encrypted service ticket requests
references:
    - https://attack.mitre.org/techniques/T1558/003/
author: SOC Analyst Home Lab
date: 2024/01/01
tags:
    - attack.credential_access
    - attack.t1558.003
logsource:
    product: windows
    service: security
detection:
    selection:
        EventID: 4769
        TicketEncryptionType: '0x17'
    filter:
        ServiceName|endswith: '$'
    condition: selection and not filter
falsepositives:
    - Legacy applications requiring RC4
level: high
